import{q as _,a as p,j as e,C as w}from"./index-D0rBU8mI.js";import{a as x}from"./index-CjQjypWB.js";import{S as r}from"./sweetalert2.esm.all-89IKscqO.js";import{b as j,a as D}from"./index.esm-BCXXLE8e.js";import{C as S,a as F}from"./CCardBody-B6T690o9.js";import{C as v}from"./CCardHeader-QsUAgxmb.js";import{C as N}from"./CForm-_gotqVwx.js";import{C as f,a as s}from"./CRow-CGjkGb4u.js";import{C as o}from"./CFormLabel-BZt0Czzq.js";import{C as l}from"./CFormInput-D2f2m-Fa.js";import"./CFormControlWrapper-Bz8xmH5l.js";import"./CFormControlValidation-DmZSENHI.js";import"./CFormText-oZ7gfTY1.js";const R=()=>{const c=_(),[g,C]=p.useState(!0),[k,d]=p.useState(!1),[h,b]=p.useState({pas_foto:null,passport:null,hasil_interview:null,id_dipnaker:null,medical_check_up:null,sert_ktkln:null});p.useEffect(()=>{const i=x.get("login");if(!i){r.fire({icon:"warning",title:"Sesi berakhir",text:"Silakan login terlebih dahulu."}).then(()=>c("/login"));return}(async()=>{try{const t=await fetch("https://be-mirai.valla.cloud/api/users/administrasi/pembayaran/check",{method:"GET",headers:{Authorization:`Bearer ${i}`}}),a=await t.json().catch(()=>({}));t.ok?d(!0):(await r.fire({icon:"error",title:"Pembayaran belum memenuhi syarat",text:(a==null?void 0:a.message)||"DP belum mencukupi untuk melanjutkan tahapan dokumen.",confirmButtonText:"Ke Halaman Pembayaran"}),c("/tahapan/pembayaran"),d(!1))}catch(t){console.error("Check DP error:",t),await r.fire({icon:"error",title:"Gagal memeriksa pembayaran",text:"Coba lagi beberapa saat."}),c("/tahapan/pembayaran"),d(!1)}finally{C(!1)}})()},[c]);const n=i=>{const{name:t,files:a}=i.target;b(m=>({...m,[t]:(a==null?void 0:a[0])||null}))},y=async i=>{if(i.preventDefault(),!k)return r.fire({icon:"error",title:"Tidak diizinkan",text:"DP belum memenuhi syarat. Selesaikan pembayaran terlebih dahulu."});const t=new FormData;for(const a in h)h[a]&&t.append(a,h[a]);try{const a=x.get("login");if(!a)return r.fire({icon:"warning",title:"Tidak ada token",text:"Silakan login."});const m=await fetch("https://be-mirai.valla.cloud/api/users/administrasi/document",{method:"POST",body:t,headers:{Authorization:`Bearer ${a}`}}),u=await m.json().catch(()=>({}));if(!m.ok)return r.fire({icon:"error",title:"Gagal Upload Dokumen",text:(u==null?void 0:u.message)||"Terjadi kesalahan saat mengunggah."});r.fire({icon:"success",title:"Berhasil Upload Dokumen",confirmButtonText:"Lanjutkan"}).then(()=>{c("/tahapan/tkd")})}catch(a){console.error(a),r.fire({icon:"error",title:"Gagal Upload Dokumen",text:"Gangguan jaringan/server. Coba lagi."})}};return g?e.jsx(j,{className:"py-5 d-flex justify-content-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{}),e.jsx("div",{className:"mt-2",children:"Memeriksa status pembayaranâ€¦"})]})}):k?e.jsx(j,{children:e.jsxs(S,{className:"mt-4",children:[e.jsx(v,{children:e.jsx("h4",{children:"Dokumen Administrasi"})}),e.jsx(F,{children:e.jsxs(N,{onSubmit:y,encType:"multipart/form-data",children:[e.jsxs(f,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"pas_foto",children:"Pas Foto (jpg/png)"}),e.jsx(l,{type:"file",name:"pas_foto",accept:".jpg,.jpeg,.png",onChange:n})]}),e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"passport",children:"Scan Passport"}),e.jsx(l,{type:"file",name:"passport",accept:".pdf,.jpg,.jpeg,.png",onChange:n})]})]}),e.jsxs(f,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"hasil_interview",children:"Hasil Interview"}),e.jsx(l,{type:"file",name:"hasil_interview",accept:".pdf",onChange:n})]}),e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"id_dipnaker",children:"ID Dipnaker"}),e.jsx(l,{type:"file",name:"id_dipnaker",accept:".pdf",onChange:n})]})]}),e.jsxs(f,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"medical_check_up",children:"Medical Check Up"}),e.jsx(l,{type:"file",name:"medical_check_up",accept:".pdf",onChange:n})]}),e.jsxs(s,{md:6,children:[e.jsx(o,{htmlFor:"sert_ktkln",children:"Sertifikat KTKLN"}),e.jsx(l,{type:"file",name:"sert_ktkln",accept:".pdf",onChange:n})]})]}),e.jsx(D,{type:"submit",color:"primary",children:"Upload Dokumen"})]})})]})}):null};export{R as default};
