import{q as L,a as c,j as a,C as q}from"./index-D0rBU8mI.js";import{a as f}from"./index-CjQjypWB.js";import{S as h}from"./sweetalert2.esm.all-89IKscqO.js";import{b as C,a as U}from"./index.esm-BCXXLE8e.js";import{C as z,a as E}from"./CCardBody-B6T690o9.js";import{C as M}from"./CCardHeader-QsUAgxmb.js";import{C as v}from"./CAlert-B3reCRga.js";import{C as O}from"./CForm-_gotqVwx.js";import{C as d,a as t}from"./CRow-CGjkGb4u.js";import{C as s}from"./CFormLabel-BZt0Czzq.js";import{C as m}from"./CFormInput-D2f2m-Fa.js";import{C as x}from"./CFormSelect-BNLYNMep.js";import"./DefaultLayout-D_CVav-E.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-Bz8xmH5l.js";import"./CFormControlValidation-DmZSENHI.js";import"./CFormText-oZ7gfTY1.js";const A="https://be-mirai.valla.cloud/api/users/administrasi/biodata/one",D="https://be-mirai.valla.cloud/api/users/administrasi/biodata",J="https://be-mirai.valla.cloud/api/users/administrasi/biodata",ta=()=>{const j=L(),[N,F]=c.useState(!0),[p,u]=c.useState(!1),[n,k]=c.useState({nama:"",jenis_kelamin:"",nomor_paspor:"",tanggal_lahir:"",tempat_lahir:"",nik_ktp:"",alamat:"",email:"",phone_number:"",nama_ortu:"",alamat_ortu:"",handphone_ortu:"",keterangan_jurusan:"",tingkat_bahasa:"",jenis_sim:"",pengalaman_jepang:""}),[S,w]=c.useState({scan_akta:null,scan_ktp:null,scan_kartukeluarga:null,scan_ijazah_sd:null,scan_ijazah_smp:null,scan_ijazah_sma:null,scan_ijazah_s1:null,sertifikat_bahasa:null,sertifikat_skillworker:null,cv:null,scan_sim:null,dokumen_pengalaman:null});c.useEffect(()=>{const o=f.get("login");if(!o){h.fire({icon:"warning",title:"Sesi berakhir",text:"Silakan login terlebih dahulu."}).then(()=>j("/login"));return}(async()=>{try{const r=await fetch(A,{headers:{Authorization:`Bearer ${o}`}});if(r.ok){const i=await r.json().catch(()=>({})),e=(i==null?void 0:i.data)||i;e?(u(!0),k({nama:e.nama??"",jenis_kelamin:(e.jenis_kelamin??"").toString().toUpperCase(),nomor_paspor:e.nomor_paspor??"",tanggal_lahir:e.tanggal_lahir?String(e.tanggal_lahir).slice(0,10):"",tempat_lahir:e.tempat_lahir??"",nik_ktp:e.nik_ktp??"",alamat:e.alamat??"",email:e.email??"",phone_number:e.phone_number??"",nama_ortu:e.nama_ortu??"",alamat_ortu:e.alamat_ortu??"",handphone_ortu:e.handphone_ortu??"",keterangan_jurusan:e.keterangan_jurusan??"",tingkat_bahasa:e.tingkat_bahasa??"",jenis_sim:e.jenis_sim??"",pengalaman_jepang:(e.pengalaman_jepang??"").toString().toLowerCase()})):u(!1)}else r.status,u(!1)}catch(r){console.error("Gagal memuat biodata:",r),u(!1)}finally{F(!1)}})()},[j]);const l=o=>{const{name:r,value:i}=o.target;k(e=>({...e,[r]:i}))},y=o=>{const{name:r,files:i}=o.target;w(e=>({...e,[r]:(i==null?void 0:i[0])||null}))},P=()=>["nama","jenis_kelamin","tanggal_lahir","nik_ktp","alamat","email","nama_ortu","alamat_ortu","handphone_ortu"].filter(r=>!String(n[r]||"").trim()),T=async o=>{o.preventDefault();const r=f.get("login");if(!r)return h.fire({icon:"warning",title:"Tidak ada token",text:"Silakan login terlebih dahulu."});if(P().length>0)return h.fire({icon:"warning",title:"Beberapa field wajib diisi",text:"Mohon lengkapi data yang wajib."});const e=new FormData;e.append("nama",n.nama),e.append("jenis_kelamin",(n.jenis_kelamin||"").toUpperCase()),e.append("nomor_paspor",n.nomor_paspor||""),e.append("tanggal_lahir",n.tanggal_lahir||""),e.append("tempat_lahir",n.tempat_lahir||""),e.append("nik_ktp",n.nik_ktp||""),e.append("alamat",n.alamat||""),e.append("email",n.email||""),e.append("phone_number",n.phone_number||""),e.append("nama_ortu",n.nama_ortu||""),e.append("alamat_ortu",n.alamat_ortu||""),e.append("handphone_ortu",n.handphone_ortu||""),e.append("keterangan_jurusan",n.keterangan_jurusan||""),e.append("tingkat_bahasa",n.tingkat_bahasa||""),e.append("jenis_sim",n.jenis_sim||""),e.append("pengalaman_jepang",(n.pengalaman_jepang||"").toLowerCase()),Object.entries(S).forEach(([_,g])=>{g&&e.append(_,g)}),h.fire({title:p?"Memperbarui biodata...":"Menyimpan biodata...",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>h.showLoading()});try{const b=await fetch(p?J:D,{method:p?"PUT":"POST",headers:{Authorization:`Bearer ${r}`},body:e}),B=await b.json().catch(()=>({}));if(h.close(),!b.ok)return h.fire({icon:"error",title:"Gagal Menyimpan",text:B.message||"Terjadi kesalahan saat menyimpan biodata."});h.fire({icon:"success",title:p?"Berhasil diperbarui!":"Berhasil!",text:"Biodata berhasil disimpan."}).then(()=>j("/tahapan/pembayaran"))}catch(_){h.close(),console.error("Error:",_),h.fire({icon:"error",title:"Kesalahan Jaringan",text:"Tidak dapat terhubung ke server. Coba lagi nanti."})}};return N?a.jsx(C,{className:"py-5 d-flex justify-content-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(q,{}),a.jsx("div",{className:"mt-2",children:"Memuat biodataâ€¦"})]})}):a.jsx(C,{children:a.jsxs(z,{className:"mt-4",children:[a.jsx(M,{children:a.jsx("h4",{children:p?"Ubah Biodata":"Biodata"})}),a.jsxs(E,{children:[p&&a.jsxs(v,{color:"info",className:"mb-3",children:[a.jsx("strong",{children:"Mode edit:"})," Data biodata ditemukan dan sudah diprefill. Unggah ulang berkas jika ingin mengganti."]}),a.jsxs(O,{onSubmit:T,children:[a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"nama",children:"Nama Lengkap"}),a.jsx(m,{name:"nama",value:n.nama,onChange:l,required:!0})]}),a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"jenis_kelamin",children:"Jenis Kelamin"}),a.jsxs(x,{name:"jenis_kelamin",value:n.jenis_kelamin,onChange:l,required:!0,children:[a.jsx("option",{value:"",children:"Pilih"}),a.jsx("option",{value:"L",children:"Laki-laki"}),a.jsx("option",{value:"P",children:"Perempuan"})]})]})]}),a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"nomor_paspor",children:"Nomor Paspor"}),a.jsx(m,{name:"nomor_paspor",value:n.nomor_paspor,onChange:l})]}),a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"phone_number",children:"Nomor HP"}),a.jsx(m,{name:"phone_number",value:n.phone_number,onChange:l})]})]}),a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"tanggal_lahir",children:"Tanggal Lahir"}),a.jsx(m,{type:"date",name:"tanggal_lahir",value:n.tanggal_lahir,onChange:l,required:!0})]}),a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"tempat_lahir",children:"Tempat Lahir"}),a.jsx(m,{name:"tempat_lahir",value:n.tempat_lahir,onChange:l})]})]}),a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"nik_ktp",children:"NIK KTP"}),a.jsx(m,{name:"nik_ktp",value:n.nik_ktp,onChange:l,required:!0})]}),a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"email",children:"Email"}),a.jsx(m,{type:"email",name:"email",value:n.email,onChange:l,required:!0})]})]}),a.jsx(d,{className:"mb-3",children:a.jsxs(t,{children:[a.jsx(s,{htmlFor:"alamat",children:"Alamat"}),a.jsx(m,{name:"alamat",value:n.alamat,onChange:l,required:!0})]})}),a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"nama_ortu",children:"Nama Orang Tua"}),a.jsx(m,{name:"nama_ortu",value:n.nama_ortu,onChange:l,required:!0})]}),a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"handphone_ortu",children:"Nomor HP Orang Tua"}),a.jsx(m,{name:"handphone_ortu",value:n.handphone_ortu,onChange:l,required:!0})]})]}),a.jsx(d,{className:"mb-3",children:a.jsxs(t,{children:[a.jsx(s,{htmlFor:"alamat_ortu",children:"Alamat Orang Tua"}),a.jsx(m,{name:"alamat_ortu",value:n.alamat_ortu,onChange:l,required:!0})]})}),a.jsxs(d,{className:"mb-3",children:[a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:"keterangan_jurusan",children:"Keterangan Jurusan"}),a.jsx(m,{name:"keterangan_jurusan",value:n.keterangan_jurusan,onChange:l})]}),a.jsxs(t,{md:3,children:[a.jsx(s,{htmlFor:"tingkat_bahasa",children:"Tingkat Bahasa (JLPT)"}),a.jsxs(x,{name:"tingkat_bahasa",value:n.tingkat_bahasa,onChange:l,children:[a.jsx("option",{value:"",children:"Pilih"}),a.jsx("option",{value:"W4",children:"W4"}),a.jsx("option",{value:"N3",children:"N3"}),a.jsx("option",{value:"N2",children:"N2"}),a.jsx("option",{value:"N1",children:"N1"})]})]}),a.jsxs(t,{md:3,children:[a.jsx(s,{htmlFor:"jenis_sim",children:"Jenis SIM"}),a.jsx(m,{name:"jenis_sim",value:n.jenis_sim,onChange:l,placeholder:"A / B / C / A1 dst.",maxLength:5})]})]}),a.jsx(d,{className:"mb-4",children:a.jsxs(t,{md:3,children:[a.jsx(s,{htmlFor:"pengalaman_jepang",children:"Pengalaman ke Jepang"}),a.jsxs(x,{name:"pengalaman_jepang",value:n.pengalaman_jepang,onChange:l,children:[a.jsx("option",{value:"",children:"Pilih"}),a.jsx("option",{value:"ya",children:"Ya"}),a.jsx("option",{value:"tidak",children:"Tidak"})]})]})}),p&&a.jsx(v,{color:"secondary",className:"mb-2",children:"Berkas yang sudah pernah diunggah tidak bisa diprefill oleh browser. Pilih berkas baru jika ingin mengganti."}),a.jsx("h6",{className:"mb-2",children:"Unggah Dokumen (opsional, jika ada)"}),["scan_akta","scan_ktp","scan_kartukeluarga","scan_ijazah_sd","scan_ijazah_smp","scan_ijazah_sma","scan_ijazah_s1","sertifikat_bahasa","sertifikat_skillworker","cv","scan_sim","dokumen_pengalaman"].reduce((o,r,i)=>{const e=Math.floor(i/2);return o[e]||(o[e]=[]),o[e].push(r),o},[]).map((o,r)=>a.jsx(d,{className:"mb-3",children:o.map(i=>a.jsxs(t,{md:6,children:[a.jsx(s,{htmlFor:i,children:i.replace(/_/g," ").toUpperCase()}),a.jsx(m,{type:"file",name:i,onChange:y})]},i))},r)),a.jsx(U,{type:"submit",color:"primary",children:p?"Perbarui Biodata":"Simpan Biodata"})]})]})]})})};export{ta as default};
