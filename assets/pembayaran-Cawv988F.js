import{x as T,q as U,a as o,j as e,C as _}from"./index-C6mMUq5w.js";import{a as M}from"./index-xsH4HHeE.js";import{a as S}from"./index-CjQjypWB.js";import{C as V,a as z}from"./CCardBody-gDBQUuD8.js";import{C as F}from"./CCardHeader-D174EtRf.js";import{C as I}from"./CCardTitle-DOZAZvAL.js";import{C as p,a as i}from"./CRow-B8XJxCvJ.js";import{C as A}from"./CFormLabel-CZasDc-G.js";import{C as E}from"./CFormText-baHXDdj0.js";import{a as f}from"./index.esm-BFnYFe3D.js";const D="https://be-mirai.valla.cloud/api/adm/usr/viewPDF",O="tbl_documents",P=a=>`https://be-mirai.valla.cloud/api/adm/usr/administrasi/${a}`,L=["visa","dokumen_visa","scan_visa"],N=["cert_ofeligibility","certificate_of_eligibility","coe","cert_eligibility"],d=a=>{if(!a)return!1;if(typeof a=="object"){if(Array.isArray(a.data))return a.data.length>0;if("type"in a&&a.type==="Buffer")return!0}return!!a},Z=()=>{const{user_id:a}=T(),w=U(),[s,R]=o.useState(null),[x,v]=o.useState(!0),[c,j]=o.useState(null);o.useEffect(()=>{(async()=>{try{const r=S.get("login"),{data:t}=await M.get(P(a),{headers:{Authorization:`Bearer ${r}`}});R((t==null?void 0:t.data)||{})}catch(r){console.error("Gagal mengambil dokumen lanjutan:",r)}finally{v(!1)}})()},[a]);const C=o.useMemo(()=>L.find(n=>d(s==null?void 0:s[n]))||L[0],[s]),b=o.useMemo(()=>N.find(n=>d(s==null?void 0:s[n]))||N[0],[s]),m=d(s==null?void 0:s[C]),u=d(s==null?void 0:s[b]),g=async(n,r)=>{try{j(r);const t=S.get("login"),l=await fetch(D,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json",Accept:"application/pdf"},body:JSON.stringify({userid:a,columns:n,table:O})}),B=l.headers.get("content-type")||"";if(!l.ok&&B.includes("application/json")){const h=await l.json().catch(()=>({}));throw new Error((h==null?void 0:h.message)||"Gagal memuat dokumen")}const k=await l.blob();if(k.size===0)throw new Error("File kosong / tidak ditemukan");const y=URL.createObjectURL(k);window.open(y,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(y),6e4)}catch(t){alert((t==null?void 0:t.message)||"Tidak dapat membuka dokumen")}finally{j(null)}};return e.jsxs(V,{children:[e.jsx(F,{children:e.jsxs(I,{children:["Dokumen Lanjutan — ",a]})}),e.jsxs(z,{children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{md:4,children:e.jsx(A,{children:"Visa"})}),e.jsx(i,{md:4,children:e.jsx(E,{className:m?"text-success":"text-danger",children:x?"Memuat…":m?"✔️ Sudah diupload":"❌ Belum diupload"})}),e.jsx(i,{md:4,children:m&&e.jsx(f,{size:"sm",color:"info",disabled:c==="visa",onClick:()=>g(C,"visa"),children:c==="visa"?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",className:"me-2"})," Membuka…"]}):"View"})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{md:4,children:e.jsx(A,{children:"Certificate of Eligibility"})}),e.jsx(i,{md:4,children:e.jsx(E,{className:u?"text-success":"text-danger",children:x?"Memuat…":u?"✔️ Sudah diupload":"❌ Belum diupload"})}),e.jsx(i,{md:4,children:u&&e.jsx(f,{size:"sm",color:"info",disabled:c==="coe",onClick:()=>g(b,"coe"),children:c==="coe"?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",className:"me-2"})," Membuka…"]}):"View"})})]}),e.jsx(p,{className:"mt-3",children:e.jsx(i,{className:"d-flex justify-content-end",children:e.jsx(f,{color:"secondary",onClick:()=>w("/admin"),children:"Kembali ke Dashboard"})})})]})]})};export{Z as default};
