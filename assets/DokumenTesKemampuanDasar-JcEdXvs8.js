import{q as y,a as o,j as a,C as w}from"./index-C6mMUq5w.js";import{a as d}from"./index-CjQjypWB.js";import{S as r}from"./sweetalert2.esm.all-89IKscqO.js";import{b as p,a as D}from"./index.esm-BFnYFe3D.js";import{C as S,a as v}from"./CCardBody-gDBQUuD8.js";import{C as F}from"./CCardHeader-D174EtRf.js";import{C as T}from"./CForm-DOp7Y24-.js";import{C as B,a as f}from"./CRow-B8XJxCvJ.js";import{C as g}from"./CFormLabel-CZasDc-G.js";import{C as x}from"./CFormInput-C0niFpvg.js";import"./CFormControlWrapper-BFmmxZq2.js";import"./CFormControlValidation-CP5S10L1.js";import"./CFormText-baHXDdj0.js";const q=()=>{const n=y(),[b,C]=o.useState(!0),[u,l]=o.useState(!1),[m,j]=o.useState({visa:null,cert_ofeligibility:null});o.useEffect(()=>{const i=d.get("login");if(!i){r.fire({icon:"warning",title:"Sesi berakhir",text:"Silakan login terlebih dahulu."}).then(()=>n("/login"));return}(async()=>{try{const t=await fetch("https://be-mirai.valla.cloud/api/users/administrasi/pembayaran/lunas",{method:"GET",headers:{Authorization:`Bearer ${i}`}}),e=await t.json().catch(()=>({}));t.ok?l(!0):(await r.fire({icon:"error",title:"Pembayaran belum memenuhi syarat",text:(e==null?void 0:e.message)||"DP belum mencukupi untuk melanjutkan.",confirmButtonText:"Ke Halaman Pembayaran"}),l(!1),n("/tahapan/pembayaran"))}catch(t){console.error("Check DP error:",t),await r.fire({icon:"error",title:"Gagal memeriksa pembayaran",text:"Coba lagi beberapa saat."}),l(!1),n("/tahapan/pembayaran")}finally{C(!1)}})()},[n]);const h=i=>{const{name:t,files:e}=i.target;j(s=>({...s,[t]:(e==null?void 0:e[0])||null}))},k=async i=>{if(i.preventDefault(),!u)return r.fire({icon:"error",title:"Tidak diizinkan",text:"DP belum memenuhi syarat. Selesaikan pembayaran terlebih dahulu."});const t=new FormData;for(const e in m)m[e]&&t.append(e,m[e]);try{const e=d.get("login");if(!e)return r.fire({icon:"warning",title:"Tidak ada token",text:"Silakan login."});const s=await fetch("https://be-mirai.valla.cloud/api/users/administrasi/cert-visa",{method:"POST",body:t,headers:{Authorization:`Bearer ${e}`}}),c=await s.json().catch(()=>({}));if(!s.ok)return r.fire({icon:"error",title:"Gagal Upload Dokumen",text:(c==null?void 0:c.message)||"Terjadi kesalahan saat mengunggah."});r.fire({icon:"success",title:"Berhasil Upload Dokumen",confirmButtonText:"Lanjutkan"}).then(()=>{n("/tahapan/wawancara")})}catch(e){console.error(e),r.fire({icon:"error",title:"Gagal Upload Dokumen",text:"Gangguan jaringan/server. Coba lagi."})}};return b?a.jsx(p,{className:"py-5 d-flex justify-content-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(w,{}),a.jsx("div",{className:"mt-2",children:"Memeriksa status pembayaranâ€¦"})]})}):u?a.jsx(p,{children:a.jsxs(S,{className:"mt-4",children:[a.jsx(F,{children:a.jsx("h4",{children:"Dokumen Lanjutan"})}),a.jsx(v,{children:a.jsxs(T,{onSubmit:k,encType:"multipart/form-data",children:[a.jsxs(B,{className:"mb-3",children:[a.jsxs(f,{md:6,children:[a.jsx(g,{htmlFor:"visa",children:"Visa"}),a.jsx(x,{type:"file",name:"visa",accept:".pdf",onChange:h})]}),a.jsxs(f,{md:6,children:[a.jsx(g,{htmlFor:"cert_ofeligibility",children:"Certificate of Eligibility"}),a.jsx(x,{type:"file",name:"cert_ofeligibility",accept:".pdf",onChange:h})]})]}),a.jsx(D,{type:"submit",color:"primary",children:"Upload Dokumen Lanjutan"})]})})]})}):null};export{q as default};
