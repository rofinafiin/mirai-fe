import{a as s,q as D,j as a,C as G}from"./index-C6mMUq5w.js";import{a as k}from"./index-CjQjypWB.js";import{S as o}from"./sweetalert2.esm.all-89IKscqO.js";import{a as E}from"./index-xsH4HHeE.js";import{b as C,a as T}from"./index.esm-BFnYFe3D.js";import{C as q,a as A}from"./CCardBody-gDBQUuD8.js";import{C as I}from"./CCardHeader-D174EtRf.js";import{C as L}from"./CAlert-DklNaJ9p.js";import{C as M}from"./CForm-DOp7Y24-.js";import{C as v,a as f}from"./CRow-B8XJxCvJ.js";import{C as N}from"./CFormLabel-CZasDc-G.js";import{C as S}from"./CFormInput-C0niFpvg.js";import{C as $,a as z}from"./CProgress-Dcld7k-w.js";import"./DefaultLayout-G9PbBR7y.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-BFmmxZq2.js";import"./CFormControlValidation-CP5S10L1.js";import"./CFormText-baHXDdj0.js";const la=()=>{const[g,P]=s.useState(null),[m,x]=s.useState(""),[d,u]=s.useState(0),[B,w]=s.useState(!0),[e,c]=s.useState(null),p=D(),F=t=>{var r;return P(((r=t.target.files)==null?void 0:r[0])||null)},_=t=>{const r=t.target.value;(r===""||/^\d+$/.test(r))&&x(r)};s.useEffect(()=>{const t=k.get("login");if(!t){o.fire({icon:"warning",title:"Sesi berakhir",text:"Silakan login terlebih dahulu."}).then(()=>p("/login"));return}(async()=>{try{const r=await fetch("https://be-mirai.valla.cloud/api/users/administrasi/pembayaran/one",{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const n=await r.json(),i=(n==null?void 0:n.data)||n;c(i),x(String((i==null?void 0:i.nominal_pembayaran)??""))}else if(r.status===404)c(null);else{const n=await r.json().catch(()=>({}));console.warn("Gagal get pembayaran:",n),c(null)}}catch(r){console.error("Fetch pembayaran error:",r),c(null)}finally{w(!1)}})()},[p]);const U=async t=>{var i,j;t.preventDefault();const r=k.get("login");if(!r)return o.fire({icon:"warning",title:"Tidak ada token",text:"Silakan login terlebih dahulu."});if(!g)return o.fire({icon:"warning",title:"File kosong",text:"Pilih file bukti pembayaran."});if(m===""||Number.isNaN(Number(m)))return o.fire({icon:"warning",title:"Nominal tidak valid",text:"Isi nominal pembayaran dengan angka."});const n=new FormData;n.append("bukti_pembayaran",g),n.append("nominal_pembayaran",String(m)),u(0);try{const h=(await E({method:e?"put":"post",url:e?"https://be-mirai.valla.cloud/api/users/administrasi/pembayaran/update":"https://be-mirai.valla.cloud/api/users/administrasi/pembayaran",data:n,headers:{Authorization:`Bearer ${r}`},onUploadProgress:b=>{b.total&&u(Math.round(b.loaded/b.total*100))}})).data;o.fire({icon:"success",title:e?"Berhasil Update Dokumen":"Berhasil Upload Dokumen",text:(h==null?void 0:h.message)||(e?"Bukti pembayaran berhasil diperbarui.":"Bukti pembayaran berhasil diunggah."),confirmButtonText:"Lanjutkan"}).then(()=>p("/tahapan/wawancara"))}catch(l){console.error("Upload error:",l);const y=((j=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:j.message)||"Terjadi kesalahan saat mengunggah dokumen.";o.fire({icon:"error",title:e?"Gagal Update":"Gagal Upload",text:y})}finally{u(0)}};return B?a.jsx(C,{className:"py-5 d-flex justify-content-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(G,{}),a.jsx("div",{className:"mt-2",children:"Memuat data pembayaranâ€¦"})]})}):a.jsx(C,{children:a.jsxs(q,{className:"mt-4",children:[a.jsx(I,{children:a.jsx("h4",{children:e?"Perbarui Bukti Pembayaran":"Upload Bukti Pembayaran"})}),a.jsxs(A,{children:[e&&a.jsxs(L,{color:"info",className:"mb-3",children:[a.jsx("div",{children:a.jsx("strong",{children:"Status Saat Ini"})}),a.jsxs("div",{children:["Nominal: ",(e==null?void 0:e.nominal_pembayaran)??"-"]}),a.jsxs("div",{children:["Keterangan: ",(e==null?void 0:e.keterangan)??"-"]}),"validasi"in e&&a.jsxs("div",{children:["Validasi: ",(e==null?void 0:e.validasi)??"-"]}),a.jsx("div",{className:"mt-1",children:a.jsx("em",{children:"Silakan unggah file terbaru & isi nominal untuk memperbarui."})})]}),a.jsxs(M,{onSubmit:U,encType:"multipart/form-data",children:[a.jsxs(v,{className:"mb-3",children:[a.jsxs(f,{md:6,children:[a.jsx(N,{htmlFor:"bukti_pembayaran",children:"Bukti Pembayaran (PDF/JPG/PNG)"}),a.jsx(S,{type:"file",name:"bukti_pembayaran",id:"bukti_pembayaran",accept:".pdf,.jpg,.jpeg,.png",onChange:F,required:!0})]}),a.jsxs(f,{md:6,children:[a.jsx(N,{htmlFor:"nominal_pembayaran",children:"Nominal Pembayaran"}),a.jsx(S,{type:"text",inputMode:"numeric",name:"nominal_pembayaran",id:"nominal_pembayaran",placeholder:"contoh: 250000",value:m,onChange:_,required:!0})]})]}),d>0&&d<100&&a.jsx(v,{className:"mb-3",children:a.jsx(f,{children:a.jsx($,{className:"mb-2",children:a.jsxs(z,{value:d,children:[d,"%"]})})})}),a.jsx(T,{type:"submit",color:"primary",children:e?"Update Bukti Pembayaran":"Upload Bukti Pembayaran"})]})]})]})})};export{la as default};
