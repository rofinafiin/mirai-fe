import{a as l,j as a,C as x}from"./index-D0rBU8mI.js";import{a as b}from"./index-CjQjypWB.js";import{S as m}from"./sweetalert2.esm.all-89IKscqO.js";import{C as k,a as T}from"./CCardBody-B6T690o9.js";import{C as N}from"./CCardHeader-QsUAgxmb.js";import{C as S}from"./CCardTitle-ByewHokU.js";import{C as v,a as w,b as c,c as o,d as L,e as r}from"./CTable-C8iVPGj2.js";import{C as I}from"./CFormInput-D2f2m-Fa.js";import{a as E}from"./index.esm-BCXXLE8e.js";import"./CFormControlWrapper-Bz8xmH5l.js";import"./CFormControlValidation-DmZSENHI.js";import"./CFormLabel-BZt0Czzq.js";import"./CFormText-oZ7gfTY1.js";const P="https://be-mirai.valla.cloud/api/adm/usr/payment/limit",z="https://be-mirai.valla.cloud/api/adm/usr/payment/limit",K=()=>{const[p,h]=l.useState([]),[y,f]=l.useState(!0),[u,g]=l.useState(null);l.useEffect(()=>{(async()=>{try{const i=b.get("login"),n=await fetch(P,{headers:{Authorization:`Bearer ${i}`}});if(!n.ok)throw new Error("Gagal mengambil data limit pembayaran");const t=await n.json(),_=(Array.isArray(t==null?void 0:t.data)?t.data:[]).map(d=>({limit_id:d.limit_id,nominal_pembayaran:Number(d.nominal_pembayaran??0),keterangan:d.keterangan??""}));h(_)}catch(i){m.fire({icon:"error",title:"Gagal memuat",text:i.message||"Tidak dapat mengambil data."})}finally{f(!1)}})()},[]);const j=(e,i)=>{const n=i===""?"":String(i).replace(/\D/g,"");h(t=>t.map(s=>s.limit_id===e?{...s,nominal_pembayaran:n===""?"":Number(n)}:s))},C=async e=>{if(e.nominal_pembayaran===""||isNaN(Number(e.nominal_pembayaran))){m.fire({icon:"warning",title:"Nominal tidak valid",text:"Isi dengan angka yang valid."});return}try{g(e.limit_id);const i=b.get("login"),n=await fetch(z,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({limit_id:Number(e.limit_id),nominal_pembayaran:Number(e.nominal_pembayaran),keterangan:e.keterangan})});if(!n.ok){const t=await n.json().catch(()=>({}));throw new Error((t==null?void 0:t.message)||"Gagal memperbarui limit")}m.fire({icon:"success",title:"Tersimpan",text:`Limit #${e.limit_id} berhasil diperbarui.`,timer:1400,showConfirmButton:!1})}catch(i){m.fire({icon:"error",title:"Gagal menyimpan",text:i.message||"Terjadi kesalahan."})}finally{g(null)}};return a.jsxs(k,{children:[a.jsx(N,{children:a.jsx(S,{children:"Pengaturan Limit Pembayaran"})}),a.jsx(T,{children:y?a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx(x,{size:"sm"})," ",a.jsx("span",{children:"Memuat data…"})]}):a.jsxs(v,{bordered:!0,hover:!0,responsive:!0,children:[a.jsx(w,{children:a.jsxs(c,{children:[a.jsx(o,{scope:"col",style:{width:120},children:"limit_id"}),a.jsx(o,{scope:"col",children:"nominal_pembayaran"}),a.jsx(o,{scope:"col",children:"keterangan"}),a.jsx(o,{scope:"col",style:{width:150},children:"Aksi"})]})}),a.jsx(L,{children:p.length===0?a.jsx(c,{children:a.jsx(r,{colSpan:4,className:"text-center text-muted",children:"Tidak ada data"})}):p.map(e=>a.jsxs(c,{children:[a.jsx(r,{children:e.limit_id}),a.jsx(r,{children:a.jsx(I,{type:"text",inputMode:"numeric",value:e.nominal_pembayaran,onChange:i=>j(e.limit_id,i.target.value),"aria-label":`Nominal pembayaran untuk limit ${e.limit_id}`})}),a.jsx(r,{className:"text-break",children:e.keterangan}),a.jsx(r,{children:a.jsx(E,{size:"sm",color:"primary",disabled:u===e.limit_id,onClick:()=>C(e),children:u===e.limit_id?a.jsxs(a.Fragment,{children:[a.jsx(x,{size:"sm",className:"me-2"})," Menyimpan…"]}):"Simpan"})})]},e.limit_id))})]})})]})};export{K as default};
